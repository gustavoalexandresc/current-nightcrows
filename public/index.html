<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dados da Tabela Raspada</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background-color: black;
    color: white;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
  }
  table{
    margin-top: 15px;
  }
  #loginArea {
    position: fixed;
    text-align: center;
    z-index: 2; /* Garante que a área de login esteja visível sobre o conteúdo */
  }

  /* Estilização adicional para os inputs e botão */
  input[type="password"], button {
    margin: 5px;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #555;
  }

  input[type="password"] {
    color: black;
  }

  #button-password {
    background-color: #4CAF50; /* Botão de login com uma cor destacada */
    color: white;
    cursor: pointer;
    }

  #button-password:hover {
    background-color: #45a049; /* Efeito hover para o botão */
  }

  #conteudoSecreto {
    display: none; /* Começa escondido */
    color: white; /* Garante visibilidade sobre o fundo preto */
  }

  #inputArea {
    align-items: center;
    display: flex; /* Transforma #inputArea em um contêiner flex */
    flex-wrap: wrap; /* Permite que os itens sejam organizados em várias linhas, conforme necessário */
    gap: 10px; /* Espaçamento entre os itens do contêiner flex */
    margin-bottom: 20px;
  }

  #conteudoSecreto, #moedasInput, #reaisInput, .input-container, label {
    color: white; /* Garantindo que o texto seja branco para legibilidade */
  }
  .input-container {
    color: white; /* Garantindo que o texto seja branco para legibilidade */
    display: flex; /* Ativa flexbox */
    align-items: center; /* Alinha verticalmente */
    margin-bottom: 10px;
    display: flex; /* Mantém o label e o input lado a lado */
    gap: 10px; /* Espaçamento entre o label e o input */
  }

  label {
    margin-right: 10px; /* Espaço entre o label e o input */
  }

  input[type="number"] {
    flex-grow: 1;
    max-width: 120px;
    width: auto; /* Permite que o input ajuste seu tamanho automaticamente */
    padding: 8px;
    border: 1px solid #cccccc;
    border-radius: 4px;
  }

  .input-container select {
    padding: 8px;
    box-sizing: border-box;
  }
  #buttonContainer {
    /* Isso faz com que o botão fique à direita */
    display: flex; /* Usa flexbox para permitir alinhamento */
    align-items: flex-start; /* Alinha o botão ao topo */
  }
  .button-comun {
    padding: 10px 20px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  .button-comun:hover {
    background-color: #45a049;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    border: 1px solid #555; /* Bordas mais claras para se destacar no fundo preto */
    text-align: left;
    padding: 8px;
  }
  th {
    background-color: #333; /* Fundo escuro para o cabeçalho da tabela */
  }
  tr:nth-child(even) {
    background-color: #222; /* Alternando cores de fundo para linhas da tabela */
  }

  .divTabelaRolavel {
    overflow-x: auto;
    max-width: 100%; /* Ajuste a largura máxima conforme necessário */
  }

  .divTabelaRolavel td, .divTabelaRolavel th {
    padding: 4px 8px; /* Reduz o padding */
    font-size: 14px; /* Ajuste o tamanho da fonte conforme necessário */
    min-width: 60px; /* Ou outro valor conforme a necessidade */
    align-items: center;
  }
  #divTabelaRolavel img {
    width: 20px; /* Ou outro valor conforme necessário */
    height: auto;
  }

  .loader {
    border: 16px solid #444; /* Loader com cores que combinam com o tema escuro */
    border-radius: 50%;
    border-top: 16px solid #888;
    width: 120px;
    height: 120px;
    -webkit-animation: spin 2s linear infinite; /* Safari */
    animation: spin 2s linear infinite;
  }
  .color-danger{
    color: rgb(228, 88, 88);
  }
  .color-warning{
    color: rgb(226, 181, 97)
  }
  .color-sucess{
    color: rgb(58, 224, 58)
  }

  /* Animação do Spinner */
  @-webkit-keyframes spin {
    0% { -webkit-transform: rotate(0deg); }
    100% { -webkit-transform: rotate(360deg); }
  }

  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
</style>
</head>
<body>
  <div id="loginArea">
    <input type="password" id="senha" placeholder="Digite a senha">
    <button id="button-password" onclick="verificarSenha()">Entrar</button>
  </div>
  <div id="conteudoSecreto" style="display: none;">
    <div id="loadingIndicator" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);">
      <div class="loader"></div>
    </div>
      
    <h2>Dados do Site PNIXDEX</h2>

    <div id="divDataTable"></div>

    <input type="text" id="valCrowDolar" value="" hidden>
    <h3 style="margin-top: 16px;">Valor Itens in game(diamante)</h3>

    <div id="moedasInput">
      <div id="inputArea" style="margin-bottom: 20px; margin-top: 4px;">
        <div class="input-container">
          <label for="CROW">Crows:</label>
          <img src="/moedas/crow.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="CROW">
        </div>
        <div class="input-container">
          <label for="PRO">Token:</label>
          <img src="/moedas/token.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="PRO">
        </div>
        <div class="input-container">
          <label for="PAP">Papyrus:</label>
          <img src="/moedas/papyrus.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="PAP">
        </div>
        <div class="input-container">
          <label for="MOR">Morion:</label>
          <img src="/moedas/morion.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="MOR">
        </div>
        <div class="input-container">
          <label for="GEA">Peça de vôo:</label>
          <img src="/moedas/peca-voo.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="GEA">
        </div>
        <div class="input-container">
          <label for="FEA">Ceu Azul:</label>
          <img src="/moedas/ceu-azul.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="FEA">
        </div>
        <div class="input-container">
          <label for="TEA">Lágrima congelada:</label>
          <img src="/moedas/lagrima-congelada.webp" style="width: 20px; height: 20px; margin-left: -15px;">
          <input type="number" id="TEA">
        </div>
        <button class="button-comun" style="cursor: pointer;" onclick="atualizarJSON()">Atualizar Moedas</button>
      </div>
    </div>

    <div id="reaisInput">
      <div id="inputArea" style="margin-bottom: 10px; margin-top: 16px;">
        <div class="input-container">
          <label for="crowTabDima">CROW</label>
          <input type="number" id="crowTabDima">
        </div>
        <div class="input-container">
          <label for="reaisTabDima">Reais</label>
          <input type="number" id="reaisTabDima">
        </div>
        <div class="input-container">
          <label for="dolarTabDima">Dolar</label>
          <input type="number" id="dolarTabDima">
        </div>
        <div class="input-container">
          <label for="reaisDolarDima">Reais > 1 Dolar</label>
          <input type="number" id="reaisDolarDima">
        </div>

        <div class="input-container">
          <label for="selectDimaPorReais">MOEDA:</label>
          <select id="selectDimaPorReais">
            <option value="reais" selected>REAIS</option>
            <option value="dolar">DOLAR</option>
            <option value="crow">CROW</option>
          </select>
        </div>
        <button class="button-comun" style="cursor: pointer;" onclick="atualizarValoresTabDima()">Atualizar Tabela Reais</button>
      </div>
    </div>
    <div style="color: rgb(214, 182, 0);">
      <br><span>Valor em Reais = Total que voce vai gastar em real</span><br>
      <span>Reais/Dia = Quanto reais para fazer x Diamante.</span><br>
      <span>Dia/Reais = X diamante comprados com o Reais/Dia</span><br>
      <span>Reais > 1 Dolar = Quanto em reais vale 1 dolar</span><br>
    </div>       

    <h3 style="margin-top: 16px;">Tabela de quanto diamante por DOL/Reais</h3>
    <div id="divDima" class="divTabelaRolavel"></div>     

    <h3 style="margin-top: 16px;">Tabela de lucro Dentro do jogo com CROW(HARD)</h3>
    <div id="divLucroCrowHard"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>QCU = Quantidade de crows que serão usados, para ser certinho e não ter valor picado</span><br>
      <span>QMC = Qtd de material comprado com a quantidade de moeda usada</span><br>
      <span>CMDC = Compra de material se trocar o diamante por crow e comprar material</span><br>
      <span>DNG = Qtd de diamantes para fazer o mesmo número de crow que foi gasto</span><br>
      <span>Valor VM = Valor recebido depois que vender os materiais e tiver a taxa</span><br>
      <span>Lucro(dia) = Lucro feito com a quantidade de diamante recebido da venda de materiais menos o tanto de diamante que as crows me dariam</span><br>
      <span>Lucro(crow) = Lucro em crow, commitando os diamantes</span><br>
    </div>

    <h3 style="margin-top: 16px;">
      Tabela de lucro Dentro do jogo usando Morion
      <img src="/moedas/morion-moeda.webp" style="width: 20px; height: 20px;">
      <img src="/moedas/morion.webp" style="width: 20px; height: 20px;">
    </h3>    
    <div id="divLucroMOR" class="divTabelaRolavel"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>MC = MOEDA QUE SERA CONVERTIDA</span><br>
    </div> 

    <h3 style="margin-top: 16px;">
      Tabela de lucro Dentro do jogo usando Papyrus
      <img src="/moedas/papyrus-moeda.webp" style="width: 20px; height: 20px;">
      <img src="/moedas/papyrus.webp" style="width: 20px; height: 20px;">
    </h3>
    <div id="divLucroPAP" class="divTabelaRolavel"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>MC = MOEDA QUE SERA CONVERTIDA</span><br>
    </div> 

    <h3 style="margin-top: 16px;">
      Tabela de lucro Dentro do jogo usando GEA
      <img src="/moedas/gear.webp" style="width: 20px; height: 20px;">
      <img src="/moedas/peca-voo.webp" style="width: 20px; height: 20px;">
    </h3>
    <div id="divLucroGEA" class="divTabelaRolavel"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>MC = MOEDA QUE SERA CONVERTIDA</span><br>
    </div> 

    <h3 style="margin-top: 16px;">
      Tabela de lucro Dentro do jogo usando FEA
      <img src="/moedas/feather.webp" style="width: 20px; height: 20px;">
      <img src="/moedas/ceu-azul.webp" style="width: 20px; height: 20px;">
    </h3>
    <div id="divLucroFEA" class="divTabelaRolavel"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>MC = MOEDA QUE SERA CONVERTIDA</span><br>
    </div> 

    <h3 style="margin-top: 16px;">
      Tabela de lucro Dentro do jogo usando TEA
      <img src="/moedas/tear.webp" style="width: 20px; height: 20px;">
      <img src="/moedas/lagrima-congelada.webp" style="width: 20px; height: 20px;">
    </h3>
    <div id="divLucroTEA" class="divTabelaRolavel"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>MC = MOEDA QUE SERA CONVERTIDA</span><br>
    </div> 

    <h3 style="margin-top: 16px;">
      Tabela de lucro Dentro do jogo usando PRO
      <img src="/moedas/promote.webp" style="width: 20px; height: 20px;">
      <img src="/moedas/token.webp" style="width: 20px; height: 20px;">
    </h3>
    <div id="divLucroPRO" class="divTabelaRolavel"></div>   
    <div style="color: rgb(233, 72, 72);">
      <br><span>MC = MOEDA QUE SERA CONVERTIDA</span><br>
    </div>     

    <div id="reaisInput">
      <div id="inputArea" style="margin-bottom: 10px; margin-top: 16px;">
        <div class="input-container">
          <label for="reaisTotal">Valor em Reais</label>
          <input type="number" id="reaisTotal">
        </div>
        <div class="input-container">
          <label for="reaisDia">Reais/Dia</label>
          <input type="number" id="reaisDia">
        </div>
        <div class="input-container">
          <label for="diaReais">Dia/Reais</label>
          <input type="number" id="diaReais">
        </div>
        <div class="input-container">
          <label for="reaisDolar">Reais > 1 Dolar</label>
          <input type="number" id="reaisDolar">
        </div>
        <button class="button-comun" style="cursor: pointer;" onclick="atualizarValoresReais()">Atualizar Tabela Reais</button>
      </div>
    </div>
        
    <h3 style="margin-top: 16px;">Tabela de lucro Dentro do jogo comprando diamante por Reais</h3>
    <div id="divReais" class="divTabelaRolavel"></div>   

    <h3 style="margin-top: 16px;">Tabela custo Commit</h3>
    <div id="tabCusto"></div>        


<script>
  const baseURL = window.location.origin;
  const diamanteCriarCrow = 84
  const diamanteRecebidoCrow = 80
  
  const valorInvestimentoReais = 80
  const valorReaisPorDia = 40
  const valorDiaReais = 1000
  const valorRealDolar = 5.02

  const crowTabDima = 0
  const reaisTabDima = 50
  const dolarTabDima = 0
  const reaisDolarDima = 5.09

  var dataAtualizada;


  setInterval(fetchData, 60000);data.forEach

  function atualizarTabelas(data){
    dataAtualizada = data;
    console.log('entrei')
    document.getElementById("valCrowDolar").value = data[0].precoDolar;
    console.log("crowDolar: ",document.getElementById("valCrowDolar").value)
    addTabCusto(data);
    addTabLucro(data);
    addTabsMoedas(data);
    addTabReais(data);
    addTabDima(data);
  }

  function atualizarValoresReais(data) {
    addTabReais(dataAtualizada)
  }

  function atualizarValoresTabDima(data) {
    console.log('entrei1111')

    addTabDima(dataAtualizada)
  }

  // Função para adicionar dados na tabela
  function addTabDima(data) {
    console.log('entrei22222')
    const crowTabDima = parseFloat(document.getElementById("crowTabDima").value) || 0;
    const reaisTabDima = parseFloat(document.getElementById("reaisTabDima").value) || 0;
    const dolarTabDima = parseFloat(document.getElementById("dolarTabDima").value) || 0;
    const reaisDolarDima = parseFloat(document.getElementById("reaisDolarDima").value) || 5.09;
    const selectDimaPorReais = document.getElementById("selectDimaPorReais").value;
    let crowFinalDima = 0

    if(selectDimaPorReais === 'reais'){      
      crowFinalDima = reaisTabDima/reaisDolarDima/0.76    
    }else if(selectDimaPorReais === 'crow'){
      crowFinalDima = crowTabDima
    }else if(selectDimaPorReais === 'dolar'){
      crowFinalDima = dolarTabDima/0.76
    }
    console.log(`${crowTabDima} - ${reaisTabDima} - ${dolarTabDima} - ${reaisDolarDima} - ${selectDimaPorReais}`)
    console.log(crowFinalDima)
    const divTable = document.getElementById("divDima");
    const existingTable = document.getElementById("divDimaTable");
    if (existingTable) {
      existingTable.remove(); // Remove a tabela existente corretamente
    }
    const table = document.createElement("table");
    table.id = "divDimaTable"; // Atribui um ID à nova tabela
    const spans = divTable.querySelectorAll("span");
    spans.forEach(span => span.remove());

    // Limpa a tabela antes de adicionar novos dados
    table.innerHTML = `
      <tr>
        <th>MOEDA</th>
        <th>PrecoGame</th>
        <th>qtdMoeda</th>
        <th>qtdMaterialTotal</th>
        <th>qtdDiaPorMatVendido</th>
        <th>qtdDiamantesTotal</th>
      </tr>`;

    // Itera sobre os objetos JSON e adiciona cada um como uma linha da tabela
    data.forEach(obj => {
      const imgMoedaUser = `<img src="${obj.imgMoeda}" style="width: 20px; height: 20px;">`
      if(obj.id != 'CROW'){

        const valorDiaRecebidoMaterial = obj.precoGame*0.95;
        
        const qtdMoedaComprada = Math.floor(crowFinalDima / obj.precoCrow);

        const tr = document.createElement("tr");
        
        // Cria as células (td) e as adiciona à linha (tr)
        const tdValues = [
          `${obj.id} ${imgMoedaUser}`,
          `${obj.precoGame} <img src="${obj.imgMaterial}" alt="Ícone" style="width: 20px; height: 20px;">`,
          qtdMoedaComprada,
          qtdMoedaComprada*obj.qtdMaterial,
          valorDiaRecebidoMaterial,
          valorDiaRecebidoMaterial*(qtdMoedaComprada*obj.qtdMaterial)
        ];

        tdValues.forEach(val => {
            const td = document.createElement("td");
            td.innerHTML = val;            
            tr.appendChild(td);
        });

        table.appendChild(tr);     
      }
    });
    divTable.appendChild(table);
}

  // Função para adicionar dados na tabela
  function addTabReais(data) {

    const reaisTotalVar = document.getElementById("reaisTotal").value
    const reaisDiaVar = document.getElementById("reaisDia").value
    const diaReaisVar = document.getElementById("diaReais").value
    const dolarReaisVar = document.getElementById("reaisDolar").value
    const crowDolarVar = document.getElementById("valCrowDolar").value

    const divTable = document.getElementById("divReais");
    const existingTable = document.getElementById("divReaisTable");
    if (existingTable) {
      existingTable.remove(); // Remove a tabela existente corretamente
    }
    const table = document.createElement("table");
    table.id = "divReaisTable"; // Atribui um ID à nova tabela
    const spans = divTable.querySelectorAll("span");
    spans.forEach(span => span.remove());

    // Limpa a tabela antes de adicionar novos dados
    table.innerHTML = `
      <tr>
        <th>MOEDA</th>
        <th>PrecoGAME</th>
        <th>qtdMaterialCunha</th>
        <th>custoDiaCunha</th>
        <th>precoCrow</th>
        <th>totalMateriais</th>        
        <th>totalMoedaCunhada</th>
        <th>materiaisRestantes</th>
        <th>diamantesRestantesFinal</th>
        <th>ganhoCrow</th>
        <th>ganhoDolar</th>
        <th>ganhoFinalReais</th>
        <th>LU/PR Reais</th>
      </tr>`;

    // Calcula quantos diamantes são comprados com o investimento
    const totalDiamantesComprados = reaisTotalVar/reaisDiaVar*diaReaisVar;

    const spanReaisTotalVar = document.createElement("span");
    const spanDolarReaisVar = document.createElement("span");
    const spanCrowDolarVar = document.createElement("span");
    const spanTotalDiamantesComprados = document.createElement("span");
    spanReaisTotalVar.textContent = `Valor total em reais: ${reaisTotalVar}`
    spanReaisTotalVar.style.display = "block"; // Exibe o span em sua própria linha
    spanDolarReaisVar.textContent = `Valor de 1 dolar em reais: ${dolarReaisVar}`
    spanDolarReaisVar.style.display = "block"; // Exibe o span em sua própria linha
    spanCrowDolarVar.textContent = `Valor de 1 crow em dolar: ${crowDolarVar}`
    spanCrowDolarVar.style.display = "block"; // Exibe o span em sua própria linha
    spanTotalDiamantesComprados.textContent = `Quantidade total de diamantes comprados: ${totalDiamantesComprados}`
    spanTotalDiamantesComprados.style.display = "block"; // Exibe o span em sua própria linha

    // Itera sobre os objetos JSON e adiciona cada um como uma linha da tabela
    data.forEach(obj => {
      const imgMoedaUser = `<img src="${obj.imgMoeda}" style="width: 20px; height: 20px;">`
      if(obj.id != 'CROW'){
        const lucroInvestimento = calcularLucroInvestimentoDiamante(obj.precoGame, obj.qtdMaterial, obj.diaCommit, obj.precoCrow, 
                                  crowDolarVar, dolarReaisVar, totalDiamantesComprados)

        const tr = document.createElement("tr");
        
        if(lucroInvestimento.ganhoFinalReais-reaisTotalVar > 0){
          tr.className = 'color-sucess'
        }else if(lucroInvestimento.ganhoFinalReais-reaisTotalVar == 0){
          tr.className = 'color-warning'
        }else{
          tr.className = 'color-danger'
        }
        // Cria as células (td) e as adiciona à linha (tr)
        const tdValues = [
          `${obj.id} ${imgMoedaUser}`,
          `${obj.precoGame} <img src="${obj.imgMaterial}" alt="Ícone" style="width: 20px; height: 20px;">`,
          obj.qtdMaterial,
          obj.diaCommit,
          obj.precoCrow,
          parseFloat(lucroInvestimento.totalMateriais.toFixed(3)),
          lucroInvestimento.totalMC,
          parseFloat(lucroInvestimento.materiaisRestantes.toFixed(3)),
          lucroInvestimento.diamantesRestantesFinal,
          parseFloat(lucroInvestimento.ganhoCrow.toFixed(3)),
          parseFloat(lucroInvestimento.ganhoDolar.toFixed(3)),
          parseFloat(lucroInvestimento.ganhoFinalReais.toFixed(3)),
          parseFloat((lucroInvestimento.ganhoFinalReais-reaisTotalVar).toFixed(3)) 
        ];

        tdValues.forEach(val => {
            const td = document.createElement("td");
            td.innerHTML = val;            
            tr.appendChild(td);
        });

        table.appendChild(tr);     
      }
    });
    divTable.appendChild(spanReaisTotalVar)
    divTable.appendChild(spanDolarReaisVar)
    divTable.appendChild(spanCrowDolarVar)
    divTable.appendChild(spanTotalDiamantesComprados)
    divTable.appendChild(table);
  }

  // Função para adicionar dados na tabela
  function addMainDataToTable(data) {

    const divTable = document.getElementById("divDataTable");
    const existingTable = document.getElementById("dataTable");
    if (existingTable) {
      existingTable.remove(); // Remove a tabela existente corretamente
    }
    const table = document.createElement("table");
    table.id = "dataTable"; // Atribui um ID à nova tabela

    document.getElementById("loadingIndicator").style.display = "none";

    // Limpa a tabela antes de adicionar novos dados
    table.innerHTML = `
      <tr>
        <th>MOEDA</th>
        <th>CROW/DOLAR</th>
        <th>Change(24h)</th>
        <th>Vol (24h) Crow/Dolar</th>
        <th>Market Cap Dolar/Qtd</th>
      </tr>`;

    // Itera sobre os objetos JSON e adiciona cada um como uma linha da tabela
    data.forEach(obj => {
        const imgMoedaUser = `<img src="${obj.imgMoeda}" style="width: 25px; height: 25px;">`
        const tr = document.createElement("tr");
        if(obj.id == 'CROW' && obj.precoDolar>=0.75){   
          if(obj.precoDolar > 0.75 && obj.precoDolar <= 0.77){   
            var alarme = new Audio(`${baseURL}/audios/lvlup.mp3`);
            alarme.play();
            tr.className = 'color-danger';
          }else if(obj.precoDolar == 0.75){     
            console.log(`${baseURL}/audios/bell.mp3`)
            var alarme = new Audio(`${baseURL}/audios/bell.mp3`);
            alarme.play();
            tr.className = 'color-warning';
          }else if(obj.precoDolar > 0.77){   
            var alarme = new Audio(`${baseURL}/audios/cash.mp3`);  
            alarme.play();
            tr.className = 'color-sucess';
          }
        }
        // Cria as células (td) e as adiciona à linha (tr)
        const tdValues = [
            `${obj.nome} (${obj.id}) ${imgMoedaUser}`,
            `${obj.precoCrow}CROW / ${obj.precoDolar}$`,
            obj.change,
            `${obj.volCrow} / ${obj.volDolar}`,
            `${obj.totalVendidoDolar} / ${obj.totalVendidoQtd}`,
        ];

        tdValues.forEach(val => {
            const td = document.createElement("td");
            td.innerHTML = val;            
            tr.appendChild(td);
        });

        table.appendChild(tr);        
    });
    divTable.appendChild(table);
  }

  function addTabsMoedas(data) { 
    data.forEach(obj => {
      if(obj.id != 'CROW'){
        const divTable = document.getElementById(`divLucro${obj.id}`);
        const existingTable = document.getElementById(`tabLucro${obj.id}`);
        if (existingTable) {
          existingTable.remove(); // Remove a tabela existente corretamente
        }
        const spans = divTable.querySelectorAll("span");
        spans.forEach(span => span.remove());

        const table = document.createElement("table");
        table.id = `tabLucro${obj.id}`; // Atribui um ID à nova tabela
        // Limpa a tabela antes de adicionar novos dados
        table.innerHTML = `
          <tr>
            <th></th>
            <th>USE>CONVERT</th>
            <th>valorMC(CROW/u)</th>
            <th>precoMoedaMCParaLucro</th>
            <th>valorGameMC</th>     
            <th>qtdPossivelMoedaMC</th>     
            <th>diamantesRestantes</th>     
            <th>materiaisRestantes</th>     
            <th>ganhoCrow</th>   
            <th>Lucro/PrejuízoCrow</th>     
          </tr>`;  

        const minhasCrows = document.getElementById('CROW').value
        const spanSaldoInicialCrow = document.createElement("span");
        const spanPrecoCrowMU = document.createElement("span");
        const spanValorDiamanteMU = document.createElement("span");
        const spanQtdCrowsMU = document.createElement("span");
        const spanQtdMoedasMU = document.createElement("span");
        const spanDiaGanhosComMU = document.createElement("span");
        spanSaldoInicialCrow.textContent = `Saldo de crow: ${minhasCrows}`
        spanSaldoInicialCrow.style.display = "block"; // Exibe o span em sua própria linha
        spanPrecoCrowMU.textContent = `Valor da moeda em crow: ${obj.precoCrow}`
        spanPrecoCrowMU.style.display = "block"; // Exibe o span em sua própria linha
        spanValorDiamanteMU.innerHTML = `Valor do material no jogo(dia): ${obj.precoGame} <img src="${obj.imgMaterial}" alt="Ícone" style="width: 20px; height: 20px;">`
        spanValorDiamanteMU.style.display = "block"; // Exibe o span em sua própria linha    
        // Itera sobre os objetos JSON e adiciona cada um como uma linha da tabela    
        data.forEach(objConvert => {
          //minhasCrows, obj.precoCrow, obj.precoGame, obj.qtdMaterial, objConvert.precoCrow, objConvert.precoGame, objConvert.diaCommit, objConvert.qtdMaterial
            if(objConvert.id != obj.id && objConvert.id != 'CROW'){   
              const opEntreMoedas = calcularOperacoesEntreMoedas(minhasCrows, obj.precoCrow, obj.precoGame, obj.qtdMaterial, 
              objConvert.precoCrow, objConvert.precoGame, objConvert.diaCommit, 
              objConvert.qtdMaterial)

              const tr = document.createElement("tr");
              const imgMoedaUser = `<img src="${obj.imgMoeda}" alt="Ícone" style="width: 20px; height: 20px;">`
              const imgMoedaConvert = `<img src="${objConvert.imgMoeda}" alt="Ícone" style="width: 20px; height: 20px;">`
              const imgMoeda = `${imgMoedaUser}>${imgMoedaConvert}`
              const nomeMoeda = `${obj.id}>>${objConvert.id}`
              const crowsUsadasParaMU = opEntreMoedas.crowsUsadasParaMU
              const qtdMoedasMU = opEntreMoedas.quantidadeCompradaMU
              const diamantesGanhosComMU = opEntreMoedas.diamantesGanhosComMU
              const valorMC = objConvert.precoCrow
              const precoMoedaMCParaLucro = opEntreMoedas.precoVendaCrowMCParaLucro
              const valorGameMC = `${objConvert.precoGame} <img src="${objConvert.imgMaterial}" alt="Ícone" style="width: 20px; height: 20px;">`
              const qtdPossivelMC = opEntreMoedas.qtdPossivelMC
              const diamantesRestantes = parseFloat(opEntreMoedas.diamantesRestantes.toFixed(3))
              const materiaisRestantes = opEntreMoedas.materiaisRestantes
              const ganhoCrow = opEntreMoedas.ganhoCrow
              const lucroPrejuizo = opEntreMoedas.ganhoCrow-crowsUsadasParaMU

              spanQtdCrowsMU.textContent = `Qtd de crows que irei usar: ${crowsUsadasParaMU}`
              spanQtdCrowsMU.style.display = "block"; // Exibe o span em sua própria linha   
              spanQtdMoedasMU.textContent = `Qtd de moedas que terei: ${qtdMoedasMU}`
              spanQtdMoedasMU.style.display = "block"; // Exibe o span em sua própria linha   
              spanDiaGanhosComMU.textContent = `Qtd de diamantes que farei: ${diamantesGanhosComMU}`
              spanDiaGanhosComMU.style.display = "block"; // Exibe o span em sua própria linha   

              const teriaLucro = opEntreMoedas.teriaLucro

              if(lucroPrejuizo>0){
                tr.className = 'color-sucess'
              }else if(lucroPrejuizo == 0){
                tr.className = 'color-warning'
              }else{
                tr.className = 'color-danger'
              }

              // Cria as células (td) e as adiciona à linha (tr)
              const td = document.createElement("td");

              const tdValues = [  
                imgMoeda,  
                nomeMoeda,            
                valorMC,
                precoMoedaMCParaLucro,
                valorGameMC,
                qtdPossivelMC,
                diamantesRestantes,
                materiaisRestantes,
                parseFloat(ganhoCrow.toFixed(3)),
                parseFloat(lucroPrejuizo.toFixed(3))              
              ];
              tdValues.forEach(val => {
                  const td = document.createElement("td");
                  td.innerHTML = val;                  
                  tr.appendChild(td);
              });

              table.appendChild(tr);     
            }
        });
        divTable.appendChild(spanSaldoInicialCrow)
        divTable.appendChild(spanPrecoCrowMU)
        divTable.appendChild(spanValorDiamanteMU)
        divTable.appendChild(spanQtdCrowsMU)
        divTable.appendChild(spanQtdMoedasMU)
        divTable.appendChild(spanDiaGanhosComMU)
        divTable.appendChild(table);
      }
    });
  }
  
  function addTabLucro(data) { 
    const divTable = document.getElementById("divLucroCrowHard");
    const existingTable = document.getElementById("tabLucroCrowHard");
    if (existingTable) {
      existingTable.remove(); // Remove a tabela existente corretamente
    }
    const table = document.createElement("table");
    table.id = "tabLucroCrowHard"; // Atribui um ID à nova tabela

    // Limpa a tabela antes de adicionar novos dados
    table.innerHTML = `
      <tr>
        <th>MOEDA</th>
        <th>QCU</th>
        <th>VALOR(CROW/u)</th>
        <th>VALOR Game</th>
        <th>QMC</th>
        <th>CMDC</th>
        <th>DNG</th>
        <th>Valor VM</th>
        <th>Lucro(dia)</th>
        <th>Lucro(crow)</th>
      </tr>`;
    const minhasCrows = document.getElementById('CROW').value
    // Itera sobre os objetos JSON e adiciona cada um como uma linha da tabela
    data.forEach(obj => {
        const imgMoedaUser = `<img src="${obj.imgMoeda}" style="width: 25px; height: 25px;">`

        if(obj.id != 'CROW'){         
          const tr = document.createElement("tr");
          
          const moeda = `${obj.id} ${imgMoedaUser}`
          const qtdCrowSeraUsado = parseFloat((Math.floor(minhasCrows/obj.precoCrow)*obj.precoCrow).toFixed(3));
          const precoCrow = obj.precoCrow
          const precoGame = obj.precoGame
          const qtdMorionComprado = parseFloat((qtdCrowSeraUsado/precoCrow*obj.qtdMaterial).toFixed(3));
          const qtdCompraMatDiaCrow = parseFloat((qtdCrowSeraUsado*diamanteRecebidoCrow/precoGame).toFixed(3));
          const valorDiamanteCrowUsadoEmDiamante = parseFloat((qtdCrowSeraUsado*diamanteCriarCrow).toFixed(3));
          const valorDiamanteMatVenda = parseFloat((qtdMorionComprado*precoGame*0.95).toFixed(3));
          const lucroDia = parseFloat(((valorDiamanteMatVenda-(qtdCrowSeraUsado*diamanteCriarCrow))).toFixed(3));
          const lucroCrow = parseFloat((lucroDia/diamanteCriarCrow).toFixed(3));
          // Cria as células (td) e as adiciona à linha (tr)
          const tdValues = [
            moeda,
            qtdCrowSeraUsado,
            precoCrow,
            `${precoGame} <img src="${obj.imgMaterial}" alt="Ícone" style="width: 25px; height: 25px;">`,
            qtdMorionComprado,
            qtdCompraMatDiaCrow,
            valorDiamanteCrowUsadoEmDiamante,
            valorDiamanteMatVenda,
            lucroDia,
            lucroCrow,
          ];
          tdValues.forEach(val => {
              const td = document.createElement("td");
              td.innerHTML = val;              
              tr.appendChild(td);
          });

          table.appendChild(tr);          
          divTable.appendChild(table);
        }
    });
  }

  function addTabCusto(data) {    
    const divTable = document.getElementById("tabCusto");
    const existingTable = document.getElementById("tableCusto");
    if (existingTable) {
      existingTable.remove(); // Remove a tabela existente corretamente
    }
    const table = document.createElement("table");
    table.id = "tableCusto"; // Atribui um ID à nova tabela

    // Limpa a tabela antes de adicionar novos dados
    table.innerHTML = `
      <tr>
        <th>MOEDA</th>
        <th>MATERIAL</th>
        <th>QTD</th>
        <th>Valor Commit</th>
        <th>Preco Game</th>
        <th>Custo Total Commit</th>
      </tr>`;

    // Itera sobre os objetos JSON e adiciona cada um como uma linha da tabela
    data.forEach(obj => {
        const tr = document.createElement("tr");
        const imgMoedaUser = `<img src="${obj.imgMoeda}" style="width: 20px; height: 20px;">`

        // Cria as células (td) e as adiciona à linha (tr)
        const tdValues = [
            `${obj.id} ${imgMoedaUser}`,
            `${obj.material} <img src="${obj.imgMaterial}" alt="Ícone" style="width: 20px; height: 20px;">`,
            obj.qtdMaterial,
            `${obj.diaCommit}(dia)`,
            `${obj.precoGame}(dia)`,
            `${((obj.precoGame*obj.qtdMaterial)+obj.diaCommit)}(dia)`,
        ];

        tdValues.forEach(val => {
            const td = document.createElement("td");
            td.innerHTML = val;            
            tr.appendChild(td);
        });

        table.appendChild(tr);
        divTable.appendChild(table);
    });
  }


  
  // Busca os dados da API e os adiciona na tabela
  function fetchData() {
    document.getElementById("loadingIndicator").style.display = "block";
  
    //fetch('http://localhost:3000/data')
    fetch(`${baseURL}/data`)
      .then(response => response.json())
      .then(data => {
        // Assumindo que `data` é o array de objetos diretamente do seu JSON
        addMainDataToTable(data);
        atualizarTabelas(data);
        document.getElementById("loadingIndicator").style.display = "none";
      })
      .catch(error => {
        console.error('Erro ao buscar dados:', error);
        document.getElementById("loadingIndicator").style.display = "none";
      });
  }

  async function obterDados(){
    try {
      //const response = await fetch('http://localhost:3000/obter-dados');
      const response = await fetch(`${baseURL}/obter-dados`);
      const data = await response.json();
      inputDefaultValue(data);
      atualizarTabelas(data);
    } catch (error) {
      console.error('Erro ao buscar dados:', error);
    }
  }

  async function inputDefaultValue(data){
    if(data.length > 0 && data){
      data.forEach((moeda)=>{
        if(moeda.id && document.getElementById(moeda.id)){
          if(moeda.id == 'CROW'){
            document.getElementById(moeda.id).value = moeda.minhasCrow;
          }else{
            document.getElementById(moeda.id).value = moeda.precoGame;
          }
        }
      })
    }
  }

  async function atualizarJSON() {
    // Encontra todos os inputs dentro do contêiner de inputs
    const inputElements = document.querySelectorAll('#moedasInput input[type="number"]');
    const botaoAtualizar = document.querySelector('.button-comun'); // Seleciona o botão de atualizar
    const valores = {};

    // Itera sobre cada input e adiciona seu valor ao objeto 'valores'
    inputElements.forEach(input => {
        valores[input.id] = input.value;
        input.disabled = true; // Desabilita o input para evitar múltiplas submissões
    });
    botaoAtualizar.disabled = true; // Desabilita o botão de atualizar

    try {
      const response = await fetch('/atualizar-json', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify(valores),
      });
      const data = await response.json();
      // Sucesso na atualização
      atualizarTabelas(data.json);
    } catch (error) {
        console.error('Erro ao atualizar o JSON:', error);
    } finally {
        // Reabilita os inputs e o botão após a conclusão do processo
        inputElements.forEach(input => input.disabled = false);
        botaoAtualizar.disabled = false;
    }
  }


  function verificarSenha() {
    const senhaCorreta = '1414'; // Substitua pela senha desejada
    const senhaDigitada = document.getElementById('senha').value;

    if (senhaDigitada === senhaCorreta) {

      document.getElementById('loginArea').style.display = 'none'; // Esconde o input de senha
      document.getElementById('conteudoSecreto').style.display = 'block'; // Mostra o conteúdo restrito

      document.getElementById("reaisTotal").value = valorInvestimentoReais
      document.getElementById("reaisDia").value = valorReaisPorDia
      document.getElementById("diaReais").value = valorDiaReais
      document.getElementById("reaisDolar").value = valorRealDolar

      document.getElementById("crowTabDima").value = crowTabDima
      document.getElementById("reaisTabDima").value = reaisTabDima
      document.getElementById("dolarTabDima").value = dolarTabDima
      document.getElementById("reaisDolarDima").value = reaisDolarDima
      fetchData();
      obterDados()
    } else {
      alert('Senha incorreta!');
    }
  }

function calcularOperacoesEntreMoedas(saldoInicialCrow, precoCrowMU, valorDiamanteMU, qtdMaterialMU, precoCrowMC, 
    valorDiamanteMC, custoDiamanteCunhaMC, qtdMaterialMC, precoVendaCrowMC) {
    // Calcula quantos MU podem ser comprados com o saldo inicial de Crow
    const quantidadeCompradaMU = Math.floor(saldoInicialCrow / precoCrowMU);

    // Calcula a quantidade de Crows usadas para comprar MU
    const crowsUsadasParaMU = quantidadeCompradaMU * precoCrowMU;

    // Calcula quantos diamantes são ganhos vendendo os materiais de MU com 5% de perda
    const diamantesGanhosComMU = quantidadeCompradaMU * valorDiamanteMU * qtdMaterialMU * 0.95;

    // Determina quantos materiais para MC podem ser obtidos com os diamantes ganhos, descontando o custo para cunhar em diamantes
    const diamantesDisponiveisParaCompraMaterial = diamantesGanhosComMU - (custoDiamanteCunhaMC * Math.floor(diamantesGanhosComMU / (valorDiamanteMC * qtdMaterialMC + custoDiamanteCunhaMC)));
    const totalMateriaisMC = Math.floor(diamantesDisponiveisParaCompraMaterial / valorDiamanteMC);
    
    // Calcula quantas MC podem ser craftadas
    const qtdPossivelMC = Math.floor(totalMateriaisMC / qtdMaterialMC);

    // Calcula os materiais restantes após a tentativa de cunhar as MC
    const materiaisRestantes = totalMateriaisMC % qtdMaterialMC;

    // Calcula os diamantes restantes após a compra dos materiais e o custo de cunhagem
    const diamantesRestantes = diamantesDisponiveisParaCompraMaterial - (qtdPossivelMC * qtdMaterialMC * valorDiamanteMC) - (qtdPossivelMC * custoDiamanteCunhaMC);

    // Calcula o ganho em Crow pela venda das MC
    const ganhoCrow = qtdPossivelMC * precoCrowMC;

    // Preço de venda de MC em Crow necessário para apenas cobrir o investimento inicial
    const precoVendaCrowMCParaLucro = qtdPossivelMC > 0 ? saldoInicialCrow / qtdPossivelMC : Infinity;    

    return {
        crowsUsadasParaMU,
        quantidadeCompradaMU,
        diamantesGanhosComMU,
        qtdPossivelMC,
        diamantesRestantes,
        materiaisRestantes,
        ganhoCrow,
        precoVendaCrowMCParaLucro: precoVendaCrowMCParaLucro.toFixed(2),
    };
}


function calcularLucroInvestimentoDiamante(valorDiaMaterial, qtdMaterialMC, custoDiaCunhaMC, precoVendaCrowMC, 
                                           valorCrowDolar, valorDolarReais, totalDiamantesComprados) {

    // Conversão de Diamantes em Materiais para MC
    const totalMateriais = totalDiamantesComprados / valorDiaMaterial;

    // Calcula quantas MC podem ser cunhadas, levando em conta apenas a disponibilidade de materiais
    const totalMC = Math.floor(totalMateriais / qtdMaterialMC);
    
    // Calcula os diamantes necessários para cunhar as MCs
    const diamantesNecessariosParaCunhagem = custoDiaCunhaMC * totalMC;

    // Verifica se os diamantes restantes são suficientes para a cunhagem
    const diamantesRestantesAposMaterial = totalDiamantesComprados - (totalMC * qtdMaterialMC * valorDiaMaterial);
    const diamantesRestantesFinal = diamantesRestantesAposMaterial - diamantesNecessariosParaCunhagem;

    // Calcula os materiais restantes após a cunhagem das MCs
    const materiaisRestantes = totalMateriais - (totalMC * qtdMaterialMC);

    // Venda de MC por Crow
    const ganhoCrow = totalMC * precoVendaCrowMC;

    // Conversão de Crow para Dólar
    const ganhoDolar = ganhoCrow * valorCrowDolar;

    // Conversão de Dólar para Real
    const ganhoFinalReais = ganhoDolar * valorDolarReais;

    return {
        totalDiamantesComprados,
        totalMateriais,
        totalMC,
        diamantesRestantesFinal,
        materiaisRestantes,
        ganhoCrow,
        ganhoDolar,
        ganhoFinalReais
    };
}

</script>


</body>
</html>
